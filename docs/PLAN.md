# ntfy-hub-mcp PLAN

## アーキテクチャ概要

ntfyを利用して、AIエージェントと人間がスマホやPCを通じて対話できる仕組みをGoで構築します。

### 通信フロー
1.  **人間**: ntfyアプリまたは `curl` を使ってメッセージを送信。
    - `POST https://ntfy.sh/<topic_human_to_agent>`
2.  **エージェント (Go)**: SSE (Server-Sent Events) で上記トピックを監視。
3.  **エージェント (Go)**: 応答を生成。
4.  **エージェント (Go)**: 応答を送信。
    - `POST https://ntfy.sh/<topic_agent_to_human>`

## 現在の進捗
*   MCP サーバーとしての基本機能 (`ntfy_publish`, `ntfy_wait_for_reply`) の実装完了。
*   `go.mod` および `main.go` のリファクタリング (`ntfy-hub-mcp` へ名称変更)。
*   `Taskfile.yml` の作成。
*   `ntfy/client_test.go` によるユニットテストの実装。
*   基本ドキュメント構成 (`docs/`) の作成。

## フェーズ 1: 基本機能の安定化 (現在のフォーカス)
*   **目標**: MCP サーバーとして安定して動作し、エージェントと人間が基本的な通知と指示のやり取りを行えるようにする。
*   **タスク**:
    *   [ ] `main.go` の MCP サーバーとしての統合テストの追加 (モック化した ntfy クライアントを使用)。
    *   [ ] エラーハンドリングの強化とロギングの改善。
    *   [ ] `Taskfile.yml` に `lint-fix` などの品質チェックタスクを追加。
    *   [ ] `docs/USAGE.md` の作成（`gemini_cli_config.json` の設定例など）。
*   **成果物**: 安定した MCP サーバー実行ファイル、テストカバレッジの向上、初期ドキュメントセット。

## フェーズ 2: 高度な機能の追加
*   **目標**: ntfy の持つ豊富な機能を活用し、よりリッチな通信を可能にする。
*   **タスク**:
    *   [ ] `ntfy_publish` ツールへのタグ、優先度、アイコン、クリックアクションなどの引数追加。
    *   [ ] `ntfy_wait_for_reply` で特定のキーワードや正規表現にマッチする返信のみを待機する機能。
    *   [ ] ntfy アクション (ボタン) を利用した、人間からの選択肢形式の入力サポート。
    *   [ ] 認証が必要な ntfy サーバーへの対応（API キーまたはユーザー名/パスワード）。
*   **成果物**: 拡張された MCP ツール、より柔軟なエージェント-人間インタラクション。

## フェーズ 3: 運用と統合の改善
*   **目標**: 様々なエージェントや環境での利用を容易にする。
*   **タスク**:
    *   [ ] Docker コンテナイメージの提供。
    *   [ ] CI/CD パイプラインの構築。
    *   [ ] パフォーマンスの最適化。
    *   [ ] 他の MCP サーバー（例: `agent-hub-mcp`）との連携例の提供。
*   **成果物**: デプロイが容易なパッケージ、堅牢な開発プロセス。

## 関連するドキュメント
*   `./docs/BLUEPRINT.md`
*   `./docs/SPEC.md`
*   `./docs/USAGE.md`
