# ntfy-hub-mcp BLUEPRINT

## 概要
ntfy-hub-mcp は、ntfy.sh を介して AI エージェントと人間の間の非同期通信を可能にする MCP サーバーです。
エージェントは通知を送信したり、人間からの指示を待機したりできます。
これは、特に長時間のタスクや人間の承認が必要な場合に、エージェントの自律性を高めることを目的としています。

## アーキテクチャ
ntfy-hub-mcp は Go 言語で実装されており、MCP (Model Context Protocol) に準拠しています。
内部的には ntfy.sh の HTTP API と SSE (Server-Sent Events) を利用しています。

### 主要コンポーネント
1.  **MCP Server**: `github.com/mark3labs/mcp-go/server` を利用して MCP プロトコルを処理します。標準入出力を介して通信します。
2.  **ntfy Client**: `ntfy-hub-mcp/ntfy` パッケージに実装されており、ntfy.sh サーバーとの実際の通信（メッセージの Publish/Subscribe）を担当します。
3.  **環境変数による設定**: ntfy サーバーの URL やデフォルトのトピックは環境変数 (`NTFY_URL`, `NTFY_TOPIC_OUT`, `NTFY_TOPIC_IN`) を介して設定されます。

### 提供ツール
ntfy-hub-mcp は以下の MCP ツールを提供します。

*   **`ntfy_publish`**: 指定されたトピックにメッセージを公開します。これは、エージェントから人間への通知（例: 「タスクが完了しました」「確認が必要です」）に使用されます。
*   **`ntfy_wait_for_reply`**: 特定のトピックで人間からの返信を待機します。タイムアウトを設定でき、エージェントは人間の承認や入力が必要な場合にこのツールを使用できます。

## データフロー
1.  **エージェントが通知を送信**:
    *   エージェントは `ntfy_publish` ツールを呼び出します。
    *   ntfy-hub-mcp は `ntfy.Client` を使用して、指定されたメッセージを ntfy.sh サーバーに POST します。
    *   ntfy.sh サーバーは、購読している人間のデバイスにプッシュ通知を送信します。
2.  **エージェントが人間の返信を待機**:
    *   エージェントは `ntfy_wait_for_reply` ツールを呼び出します。
    *   ntfy-hub-mcp は `ntfy.Client` を使用して、指定されたトピックの SSE ストリームを購読します。
    *   人間が ntfy アプリや `curl` などで返信トピックにメッセージを送信すると、ntfy-hub-mcp はそれを受信し、エージェントに返します。
    *   設定されたタイムアウト内にメッセージが受信されない場合、ツールはエラーを返します。

## 開発環境
*   Go 1.25.0 以降
*   Task (go-task)

## 今後の展望
*   認証やタグ付け、優先度設定など、ntfy のより高度な機能のサポート。
*   ntfy アクション (ボタン) との連携による、人間からの構造化された指示のサポート。
*   エラーハンドリングとロギングの強化。
