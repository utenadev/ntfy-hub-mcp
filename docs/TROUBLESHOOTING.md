# ntfy-hub-mcp TROUBLESHOOTING

このドキュメントでは、`ntfy-hub-mcp` の使用中に発生する可能性のある一般的な問題と、その解決策について説明します。

---

## 1. エラー: `Failed to publish to ntfy: ...`

### 問題
`ntfy_publish` ツールまたは `ntfy_wait_for_reply` の `prompt` オプションで通知を送信しようとしたときに、ntfy サーバーへの接続または公開に失敗しました。

### 考えられる原因と解決策
*   **ntfy サーバーが稼働していない、または到達不能**:
    *   `NTFY_URL` 環境変数に指定された ntfy サーバーの URL が正しいか確認してください。
    *   自前で ntfy サーバーをホストしている場合、そのサーバーが稼働しており、`ntfy-hub-mcp` が動作しているマシンからアクセス可能であることを確認してください。ファイアウォールの設定も確認してください。
    *   パブリックな `https://ntfy.sh` を使用している場合、インターネット接続に問題がないか確認してください。
*   **ネットワークの問題**:
    *   `ntfy-hub-mcp` が動作しているマシンがインターネットに接続されていることを確認してください。
    *   プロキシ設定が必要な場合は、Go アプリケーションがプロキシを使用できるように環境変数 (`HTTP_PROXY`, `HTTPS_PROXY`) を設定してください。
*   **ntfy サーバーの認証設定**:
    *   ntfy サーバーが認証を必要とする場合（ユーザー名/パスワードまたはアクセスキー）、現在の `ntfy-hub-mcp` の実装はそれらをサポートしていません。将来的には対応する予定ですが、現状では認証不要なエンドポイントを使用するか、ntfy サーバーの認証設定を一時的に緩和することを検討してください（非推奨）。

---

## 2. エラー: `Timed out waiting for reply on topic 'TOPIC_NAME' after N seconds`

### 問題
`ntfy_wait_for_reply` ツールが、指定された `timeout_seconds` 内に人間からの返信を受信できませんでした。

### 考えられる原因と解決策
*   **返信がタイムアウト内に送信されなかった**:
    *   人間が時間内に ntfy クライアントからメッセージを送信したか確認してください。
    *   `timeout_seconds` の値を増やし、人間が返信するまでの時間を長くしてください。
*   **購読トピックの誤り**:
    *   `ntfy_wait_for_reply` ツールの `topic` 引数、または `NTFY_TOPIC_IN` 環境変数の値が、人間がメッセージを送信しているトピックと一致しているか確認してください。
*   **ntfy サーバーからの SSE ストリームの問題**:
    *   ntfy サーバーが SSE ストリームを正しく提供しているか確認してください。ブラウザで `NTFY_URL/TOPIC_NAME/json` にアクセスして、イベントが流れてくるか確認できます。
    *   ネットワークの問題やファイアウォールが SSE 接続をブロックしていないか確認してください。
*   **ntfy クライアントの設定**:
    *   人間のデバイス上の ntfy クライアントが、正しいトピックを購読しており、通知を受け取れているか確認してください。

---

## 3. エラー: `Server error: ...`

### 問題
`ntfy-hub-mcp.exe` の起動中または実行中に、MCP サーバー自体で内部エラーが発生しました。

### 考えられる原因と解決策
*   **MCP プロトコルエラー**:
    *   Gemini CLI から送信される MCP リクエストが `ntfy-hub-mcp` の期待する形式と異なる可能性があります。Gemini CLI のバージョンを確認するか、`ntfy-hub-mcp` のログ出力（もしあれば）を確認してください。
*   **Go のランタイムエラー**:
    *   Go のプログラム内部で予期せぬエラーが発生している可能性があります。`ntfy-hub-mcp.exe` をデバッグモードで実行したり、標準エラー出力に詳細なログが出力されていないか確認してください。
    *   もし詳細なエラーメッセージが得られる場合は、それを元に Go のコードを調査・修正する必要があります。

---

## 4. `Taskfile.yml` が見つからない/実行できない

### 問題
`task` コマンドを実行しても `Taskfile.yml` が見つからない、またはエラーが発生する。

### 考えられる原因と解決策
*   **Task のインストール不足**:
    *   [`go-task`](https://taskfile.dev/) がシステムにインストールされていることを確認してください。インストールされていない場合は、公式ドキュキュメントに従ってインストールしてください。
*   **ディレクトリの誤り**:
    *   `ntfy-hub-mcp` ディレクトリのルートで `task` コマンドを実行していることを確認してください。`Taskfile.yml` はこのディレクトリに配置されています。
*   **シンタックスエラー**:
    *   `Taskfile.yml` の YAML 構文に誤りがないか確認してください。

---

## 5. `ntfy_hub/ntfy-hub-mcp.exe` (または `ntfy-hub-mcp`) が見つからない

### 問題
`gemini_cli_config.json` で指定したパスに実行ファイルが存在しない。

### 考えられる原因と解決策
*   **ビルドされていない**:
    *   `ntfy-hub-mcp` ディレクトリで `task build` を実行し、実行ファイルが正しく生成されていることを確認してください。
*   **パスの誤り**:
    *   `gemini_cli_config.json` の `"command"` フィールドに指定されたパスが、ビルドされた `ntfy-hub-mcp.exe` への正確なフルパスであることを確認してください。

---
